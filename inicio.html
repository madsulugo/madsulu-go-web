<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>MadSulu GO - Selección de series</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background: radial-gradient(ellipse at center, #0a0a0a 0%, #121b2b 100%);
      color: #e0ffe0;
    }
    header {
      text-align: center;
      padding: 1rem;
    }
    header img {
      max-width: 250px;
      height: auto;
    }
    h2 {
      margin: 1rem 0 0.5rem 1rem;
      font-size: 1.3rem;
      font-weight: bold;
      color: #ffffff;
      text-shadow: 0 0 6px rgba(255, 255, 255, 0.6), 0 0 12px rgba(150, 150, 150, 0.4);
    }
    .categoria { margin-bottom: 2rem; }
    .scroll-row {
      display: flex;
      overflow-x: auto;
      padding: 0 1rem;
      gap: 1rem;
    }
    .scroll-row::-webkit-scrollbar { height: 8px; }
    .scroll-row::-webkit-scrollbar-thumb {
      background: rgba(255,255,255,0.08);
      border-radius: 4px;
    }
    .serie {
      position: relative;
      flex: 0 0 auto;
      width: 156px;
      border-radius: 16px;
      overflow: hidden;
      background-color: #222;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
      cursor: pointer;
      transition: transform 0.25s ease, box-shadow 0.25s ease;
    }
    .serie:hover {
      transform: scale(1.05);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.6);
    }
    .serie img {
      width: 100%;
      height: 101px;
      object-fit: cover;
      display: block;
    }
    .info { padding: 0.4rem; background: #111; }
    .info .nombre {
      font-weight: bold;
      font-size: 0.95rem;
      color: #fff;
    }
    .info .edad { font-size: 0.85rem; color: #bbb; }
    /* Buscador */
    .buscador-container {
      position: relative;
      max-width: 520px;
      margin: 15px auto;
      padding: 0 1rem;
    }
    #buscador {
      width: 100%;
      padding: 10px 12px;
      border-radius: 8px;
      border: none;
      font-size: 16px;
      outline: none;
      background: rgba(255,255,255,0.04);
      color: #fff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.5);
    }
    .sugerencias {
      position: absolute;
      top: calc(100% + 8px);
      left: 0;
      right: 0;
      background: #0b0b0b;
      border: 1px solid #444;
      border-radius: 8px;
      max-height: 240px;
      overflow-y: auto;
      display: none;
      z-index: 30;
      box-shadow: 0 8px 24px rgba(0,0,0,0.6);
    }
    .sugerencia {
      padding: 10px 12px;
      cursor: pointer;
      color: #fff;
      border-bottom: 1px solid rgba(255,255,255,0.03);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .sugerencia:last-child { border-bottom: none; }
    .sugerencia:hover { background: rgba(255,255,255,0.03); }
    .sugerencia .mini {
      width: 56px;
      height: 36px;
      object-fit: cover;
      border-radius: 6px;
      flex-shrink: 0;
      border: 1px solid rgba(255,255,255,0.04);
    }
    .sugerencias.show { display: block; animation: desplegar 350ms ease; transform-origin: top center; }
    @keyframes desplegar {
      0% { transform: scaleY(0.6); opacity: 0; }
      60% { transform: scaleY(1.03); opacity: 1; }
      100% { transform: scaleY(1); opacity: 1; }
    }

    /* Wide block (misma anchura que buscador y categorías interiores) */
    .wide-block {
      max-width: 520px;
      margin: 20px auto;
      padding: 0 1rem;
    }
    .banner {
      position: relative;
      width: 100%;
      height: 200px;
      border-radius: 20px;
      overflow: hidden;
      background-size: cover;
      background-position: center;
      display: flex;
      align-items: center;
      padding: 20px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
    }
    .banner h2 { margin: 0 0 10px; font-size: 20px; text-shadow: 1px 1px 3px rgba(0,0,0,0.6); }
    .banner a { display: inline-block; padding: 8px 14px; border: 2px solid white; border-radius: 10px; text-decoration: none; color: white; font-size: 14px; transition: all 0.3s ease; }
    .banner a:hover { background: white; color: #111; }
 <meta name="theme-color" content="#000080">
  </style>
</head>
<body>

<header>
  <img src="https://files.catbox.moe/q8rwdm.png" alt="MadSulu GO Logo">
</header>

<!-- Buscador con ruleta de sugerencias -->
<div class="buscador-container" aria-hidden="false">
  <input type="search" id="buscador" placeholder="Buscar serie..." aria-label="Buscar serie">
  <div id="sugerencias" class="sugerencias" role="listbox" aria-label="Sugerencias de series"></div>
</div>

<!-- Has visto recientemente -->
<div class="categoria">
  <h2>👀 Has visto recientemente</h2>
  <div class="scroll-row" id="recientes-list" style="padding: 0 1rem;"></div>
  <div style="max-width:520px;margin:8px auto;text-align:right;padding-right:1rem;">
    <button id="clearRecientes" type="button" style="padding:6px 10px;border-radius:8px;border:none;cursor:pointer;background:#222;color:#fff;">Limpiar</button>
  </div>
</div>

<!-- Para ti: sección que siempre muestra EXACTAMENTE 3 series -->
<div class="categoria" id="para-ti-section" aria-live="polite">
  <h2>😃 Para ti</h2>
  <div class="scroll-row" id="para-ti-list" style="padding: 0 1rem;"></div>
</div>
<!-- 🎮 Acción y aventuras -->
<div class="categoria">
  <h2>🎮 Acción y aventuras</h2>
  <div class="scroll-row">
    <div class="serie" onclick="go('pls')">
      <img src="https://files.catbox.moe/bg7dhd.png" alt="Pancho" />
      <div class="info"><div class="nombre">Pancho</div><div class="edad">+7 años</div></div>
    </div>

    <div class="serie" onclick="go('cn')">
      <img src="https://files.catbox.moe/zc0ht2.png" alt="Coñaco" />
      <div class="info"><div class="nombre">Coñaco</div><div class="edad">Adolescentes</div></div>
    </div>

    <div class="serie" onclick="go('dlr')">
      <img src="https://files.catbox.moe/2qikmp.png" alt="Demonic Legends" />
      <div class="info"><div class="nombre">Demonic Legends</div><div class="edad">Adolescentes</div></div>
    </div>

    <div class="serie" onclick="go('ctm')">
      <img src="https://files.catbox.moe/72hgd3.png" alt="CountryTubers Multiverso" />
      <div class="info"><div class="nombre">CountryTubers Multiverso</div><div class="edad">+7 años</div></div>
    </div>

    <div class="serie" onclick="go('lff')">
      <img src="https://files.catbox.moe/1axsuw.jpg" alt="Las Fumadas de Famil" />
      <div class="info"><div class="nombre">Las Fumadas de Famil</div><div class="edad">+10 años</div></div>
    </div>
  </div>
</div>

<!-- 🌐 Universos extraños y fantasía -->
<div class="categoria">
  <h2>🌐 Universos extraños y fantasía</h2>
  <div class="scroll-row">
    <div class="serie" onclick="go('pls')">
      <img src="https://files.catbox.moe/bg7dhd.png" alt="Pancho" />
      <div class="info"><div class="nombre">Pancho</div><div class="edad">+7 años</div></div>
    </div>

    <div class="serie" onclick="go('lc')">
      <img src="https://files.catbox.moe/0b1zji.png" alt="Las Californias" />
      <div class="info"><div class="nombre">Las Californias</div><div class="edad">+10 años</div></div>
    </div>

    <div class="serie" onclick="go('lcc')">
      <img src="https://files.catbox.moe/h8cro0.png" alt="CaliFornias Classic" />
      <div class="info"><div class="nombre">CaliFornias Classic</div><div class="edad">Todos</div></div>
    </div>

    <div class="serie" onclick="go('ctm')">
      <img src="https://files.catbox.moe/72hgd3.png" alt="CountryTubers Multiverso" />
      <div class="info"><div class="nombre">CountryTubers Multiverso</div><div class="edad">+7 años</div></div>
    </div>

    <div class="serie" onclick="go('skb')">
      <img src="https://files.catbox.moe/y901fw.png" alt="SkibidiBalls" />
      <div class="info"><div class="nombre">SkibidiBalls</div><div class="edad">+7 años</div></div>
    </div>
  </div>
</div>

<!-- 🤣 Comedias y parodias -->
<div class="categoria">
  <h2>🤣 Comedias y parodias</h2>
  <div class="scroll-row">
    <div class="serie" onclick="go('pls')">
      <img src="https://files.catbox.moe/bg7dhd.png" alt="Pancho" />
      <div class="info"><div class="nombre">Pancho</div><div class="edad">+7 años</div></div>
    </div>

    <div class="serie" onclick="go('btc')">
      <img src="https://files.catbox.moe/5ym1pj.png" alt="Batalla Countrytuber" />
      <div class="info"><div class="nombre">Batalla Countrytuber</div><div class="edad">+10 años</div></div>
    </div>

    <div class="serie" onclick="go('ebd')">
      <img src="https://files.catbox.moe/wr6k3n.png" alt="El bebé dinosaurio" />
      <div class="info"><div class="nombre">El bebé dinosaurio</div><div class="edad">Todos</div></div>
    </div>

    <div class="serie" onclick="go('MJa')">
      <img src="https://files.catbox.moe/ulh1ly.png" alt="MJaja Series" />
      <div class="info"><div class="nombre">MJaja Series</div><div class="edad">+10 años</div></div>
    </div>

    <div class="serie" onclick="go('skb')">
      <img src="https://files.catbox.moe/y901fw.png" alt="SkibidiBalls" />
      <div class="info"><div class="nombre">SkibidiBalls</div><div class="edad">+7 años</div></div>
    </div>
  </div>
</div>
<!-- 󰔡 MadSulu Kids -->
<div class="categoria">
  <h2>󰔡 MadSulu Kids</h2>
  <div class="scroll-row">
    <div class="serie" onclick="go('pls')">
      <img src="https://files.catbox.moe/bg7dhd.png" alt="Pancho" />
      <div class="info"><div class="nombre">Pancho</div><div class="edad">+7 años</div></div>
    </div>

    <div class="serie" onclick="go('lc')">
      <img src="https://files.catbox.moe/0b1zji.png" alt="Las Californias" />
      <div class="info"><div class="nombre">Las Californias</div><div class="edad">+10 años</div></div>
    </div>

    <div class="serie" onclick="go('lcc')">
      <img src="https://files.catbox.moe/h8cro0.png" alt="CaliFornias Classic" />
      <div class="info"><div class="nombre">CaliFornias Classic</div><div class="edad">Todos</div></div>
    </div>

    <div class="serie" onclick="go('ebd')">
      <img src="https://files.catbox.moe/wr6k3n.png" alt="El bebé dinosaurio" />
      <div class="info"><div class="nombre">El bebé dinosaurio</div><div class="edad">Todos</div></div>
    </div>

    <div class="serie" onclick="go('skb')">
      <img src="https://files.catbox.moe/y901fw.png" alt="SkibidiBalls" />
      <div class="info"><div class="nombre">SkibidiBalls</div><div class="edad">+7 años</div></div>
    </div>
  </div>
</div>

<!-- 🎨 Creador a creador -->
<div class="categoria">
  <h2>🎨 Creador a creador</h2>
  <div class="scroll-row">
    <div class="serie" onclick="go('dt')">
      <img src="https://files.catbox.moe/rlxo4n.png" alt="Dimoxtube" />
      <div class="info"><div class="nombre">Dimoxtube</div><div class="edad">-</div></div>
    </div>
  </div>
</div>
<!-- SHORTS BANNER (ahora con mismo ancho que buscador/categorías interiores) -->
<div class="wide-block">
  <div class="banner" style="background: linear-gradient(120deg, rgba(255,69,0,0.6), rgba(142,45,226,0.6)), url('https://files.catbox.moe/6ql4b0.gif') center/cover no-repeat;">
    <div style="z-index: 2;">
      <h2>descubre <br>madsulu fast momentos rapidos de series.</h2>
      <a href="#" class="shorts-link" onclick="irAShorts(); return false;">Ir a Shorts</a>
    </div>
  </div>
</div>

<!-- INFO CREADORES BANNER (mismo ancho) -->
<div class="wide-block">
  <div class="banner" style="background: linear-gradient(120deg, rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('https://files.catbox.moe/9wwyaq.png') center/cover no-repeat;">
    <div style="z-index: 2;">
      <h2>Mira la información<br>de nuestros creadores.</h2>
      <a href="#" onclick="irADescripcion(); return false;">ver descripcion</a>
    </div>
  </div>
</div>

<script>
  // normaliza referencias (quita "go:" y devuelve en lower-case)
  function normalizeRef(raw){
    if(!raw && raw !== 0) return '';
    return String(raw).replace(/^go:/i,'').trim().toLowerCase();
  }

  // Lista completa de series (PRÓXIMAMENTE ELIMINADAS: no están aquí)
  const series = [
    { nombre: "Pancho", ref: "pls", img: "https://files.catbox.moe/bg7dhd.png", descKey: "pancho", edad: "+7 años" },
    { nombre: "Las Fumadas de Famil", ref: "lff", img: "https://files.catbox.moe/1axsuw.jpg", descKey: "fumadas", edad: "+10 años" },
    { nombre: "Coñaco", ref: "cn", img: "https://files.catbox.moe/zc0ht2.png", descKey: "conaco", edad: "Adolescentes" },
    { nombre: "Demonic Legends", ref: "dlr", img: "https://files.catbox.moe/2qikmp.png", descKey: "dlr", edad: "Adolescentes" },
    { nombre: "CountryTubers Multiverso", ref: "ctm", img: "https://files.catbox.moe/72hgd3.png", descKey: "ctm", edad: "+7 años" },
    { nombre: "Las Californias", ref: "lc", img: "https://files.catbox.moe/0b1zji.png", descKey: "californias", edad: "+10 años" },
    { nombre: "CaliFornias Classic", ref: "lcc", img: "https://files.catbox.moe/h8cro0.png", descKey: "lcc", edad: "Todos" },
    { nombre: "Batalla Countrytuber", ref: "btc", img: "https://files.catbox.moe/5ym1pj.png", descKey: "btc", edad: "+10 años" },
    { nombre: "El bebé dinosaurio", ref: "ebd", img: "https://files.catbox.moe/wr6k3n.png", descKey: "ebd", edad: "Todos" },
    { nombre: "MJaja Series", ref: "MJa", img: "https://files.catbox.moe/ulh1ly.png", descKey: "mjaja", edad: "+10 años" },
    { nombre: "Dimoxtube", ref: "dt", img: "https://files.catbox.moe/rlxo4n.png", descKey: "dt", edad: "-" },
    { nombre: "SkibidiBalls", ref: "skb", img: "https://files.catbox.moe/y901fw.png", descKey: "skibidi", edad: "+7 años" }
  ];

  // Descripciones internas (solo para algoritmo)
  const descriptions = {
    pancho: "Pancho es un hot dog vegetariano que simplemente vive una vida normal, pero eso cambió cuando mientras hablaba con su amigo Hamburguer los dos fueron secuestrados",
    californias: "3 hermanos separados por fronteras y por guerras han decidido reconciliarse pero se van a atravesar con muchos problemas,revelaciones y una horrible pesadilla",
    conaco: "Todo comienza cuando Marlon, un ex trabajador de un campo de limones con una gran deuda, ... juegos infantiles pero mortales.",
    btc: "una batalla de diferentes countrytubers donde haran equipos y tendran que pasar los diferentes retos como las votaciones de la comunidad y el ultimo equipo es el ganador",
    lcc: "Las californias clasic es la primera versión de la serie de las californias ...",
    ebd: "Un grupo de preadolescentes con una hora libre en la escuela, ... el contenido mas random de todo MadSulu GO",
    mjaja: "Cortos para pasar el tiempo cuando no tengas nada que hacer y estes aburrido",
    dlr: "Cinco héroes llegan a una isla en guerra entre religiones y demonios. ... ThugMan, el criminal más peligroso del mundo.",
    fumadas: "Famil muestra lugares raros, los cuales tiene entre humor funable y humor divertido.",
    ctm: "Countrytubers de la Nada entran al mapa del mundo, ...",
    dt: "Parte social de MadSulu GO. Herramienta para subir tus propias series o chatear junto a otros amantes",
    skibidi: "Una serie sobre una serie ya existente llamada Skibidi Toilet, pero en versión Countryballs."
  };

  // KEY usada por el selector de perfiles (si otra pantalla la guarda)
  const ACTIVE_KEY = 'madsulu_active_profile';

  function getActiveProfile() {
    try {
      const raw = localStorage.getItem(ACTIVE_KEY);
      if (!raw) return null;
      return JSON.parse(raw);
    } catch (e) {
      console.warn('Error parseando ACTIVE_KEY', e);
      return null;
    }
  }

  // RECENTES por usuario
  function recientesKeyForActive() {
    const active = getActiveProfile();
    if (!active) return 'madsulu_recientes_guest';
    const id = (typeof active.index === 'number') ? ('idx' + active.index) : ('name_' + String(active.name || 'unk').replace(/\s+/g,'_'));
    return 'madsulu_recientes_' + id;
  }

  function getAllSeries(){
    return window.series || series || [];
  }

  // --- RENDER "Para ti" (exactamente 3 series)
  function renderParaTi(){
    const container = document.getElementById('para-ti-list');
    if (!container) return;
    container.innerHTML = '';
    const key = recientesKeyForActive();
    let recientes = JSON.parse(localStorage.getItem(key) || '[]');
    // normalizar recientes refs
    recientes = recientes.map(r => ({...r, ref: normalizeRef(r.ref)}));

  // build candidate pool
  const pool = getAllSeries().slice();
  const recientesRefs = recientes.map(r => normalizeRef(r.ref));
  let picks = [];

  if (recientes.length){
    const combined = recientes.map(r => {
      const s = pool.find(p => normalizeRef(p.ref) === normalizeRef(r.ref)) || {};
      return descriptions[s.descKey] || '';
    }).join(' ').toLowerCase();

    const scores = pool.map(p => {
      if (recientesRefs.includes(normalizeRef(p.ref))) return {ref:p.ref, score:-1};
      const desc = (descriptions[p.descKey] || '').toLowerCase();
      const words = desc.split(/\W+/).filter(Boolean);
      let score = 0;
      for (const w of words) if (combined.includes(w) && w.length>3) score++;
      return {ref:p.ref, score};
    }).sort((a,b)=> b.score - a.score);

    for (const s of scores){
      if (s.score<=0) break;
      const item = pool.find(p => normalizeRef(p.ref) === normalizeRef(s.ref));
      if (item) picks.push(item);
      if (picks.length>=3) break;
    }
  }

  // fill with randoms
  const remaining = pool.filter(p => !picks.find(x=>normalizeRef(x.ref)===normalizeRef(p.ref)));
  while (picks.length < 3 && remaining.length){
    const idx = Math.floor(Math.random()*remaining.length);
    picks.push(remaining.splice(idx,1)[0]);
  }

  picks = picks.slice(0,3);

  // render
  picks.forEach(item=>{
    const div = document.createElement('div');
    div.className='serie';
    div.style.width='140px';
    div.style.marginRight='10px';
    div.onclick = () => { window.go && window.go(item.ref); };
    const edad = item.edad || '+7 años';
    div.innerHTML = '<img src="'+(item.img||'https://files.catbox.moe/bg7dhd.png')+'" alt="'+item.nombre+'">'+
                    '<div class="info"><div class="nombre">'+item.nombre+'</div><div class="edad">'+edad+'</div></div>';
    container.appendChild(div);
  });
}

  // Añade un ref a los recientes **del usuario activo** (normaliza ref)
  function addToRecientes(rawRef){
    try{
      const nref = normalizeRef(rawRef);
      const all = getAllSeries();
      const s = (all.find ? all.find(x => normalizeRef(x.ref) === nref) : undefined) || { nombre: nref, img: '' };
      const key = recientesKeyForActive();
      let arr = JSON.parse(localStorage.getItem(key) || '[]');
      arr = arr.filter(a => normalizeRef(a.ref) !== nref);
      arr.unshift({ ref: nref, nombre: s.nombre || nref, img: s.img || '', ts: Date.now() });
      if (arr.length > 8) arr = arr.slice(0,8);
      localStorage.setItem(key, JSON.stringify(arr));
      renderRecientes();
      renderParaTi();
    } catch (e) {
      console.warn('Error guardando recientes', e);
    }
  }

  // Render recientes (usa matching case-insensitive)
  function renderRecientes(){
    const container = document.getElementById('recientes-list');
    if (!container) return;
    const key = recientesKeyForActive();
    const arrRaw = JSON.parse(localStorage.getItem(key) || '[]');
    const arr = arrRaw.map(a => ({...a, ref: normalizeRef(a.ref), nombre: (a.nombre||'').replace(/^go:/i,'')}));
    container.innerHTML = '';
    if (!arr.length) {
      const active = getActiveProfile();
      const quien = active ? (active.name || 'este usuario') : 'este dispositivo (invitado)';
      container.innerHTML = '<p style="color:#bbb;padding:12px">No has visto nada recientemente para ' + quien + '.</p>';
      return;
    }
    const all = getAllSeries();
    arr.forEach(item => {
      const match = (all.find ? all.find(s => normalizeRef(s.ref) === normalizeRef(item.ref)) : undefined) || {};
      const nombre = match.nombre || item.nombre || item.ref;
      const img = match.img || item.img || 'ht
